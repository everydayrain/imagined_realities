<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="pretty-atom-feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <title>Imagined Realities</title>
  <subtitle>Cyber Security and Stray Thoughts.</subtitle>
  <link href="https://christopherbauer.org/11ty-wisp/feed/feed.xml" rel="self" />
  <link href="https://christopherbauer.org/11ty-wisp/" />
  <updated>2025-01-24T00:00:00Z</updated>
  <id>https://christopherbauer.org/11ty-wisp/</id>
  <author>
    <name>Christopher Bauer</name>
  </author>
  <entry>
    <title>Graylog on Proxmox and Ansible for Client Config</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2025-01-24-graylog/" />
    <updated>2025-01-24T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2025-01-24-graylog/</id>
    <content type="html">&lt;h3 id=&quot;summary&quot;&gt;Summary&lt;/h3&gt;
&lt;p&gt;This is a bit of an hodgepodge post offering a few pieces of advice and a rough model of Ansible code for Rsyslog instead of a step-by-step guide. This post assumes the reader has foreknowledge of Grayhound as a tool, and a desire to install it using conventional package managers. It moreover assumes the reader is comfortable enough with the Linux command line to install and with Ansible roles and execution.&lt;/p&gt;
&lt;h3 id=&quot;introduction&quot;&gt;Introduction&lt;/h3&gt;
&lt;p&gt;In this post I&#39;m not going to detail the individual steps of installing Graylog on a Proxmox VM. I found that &lt;a href=&quot;https://go2docs.graylog.org/current/home.htm&quot;&gt;the official docs &lt;/a&gt; are sufficient, even if the overall documentation is hard to navigate. Moreover, it&#39;d make this post too long to include all the steps for installing the MongoDB instance, the Graylog Node and then Graylog itself in addition to the pitfalls and Ansible code I&#39;m outlining here. So I suggest reviewing &lt;a href=&quot;https://go2docs.graylog.org/current/home.htm&quot;&gt;the official docs &lt;/a&gt; in tandem with this post.&lt;/p&gt;
&lt;p&gt;Instead, I&#39;m going to cover two notes on how to make an install of Graylog on a Proxmox VM go more smoothly. If I&#39;d known about these challenges ahead of time I could have saved myself a little pain. For a bonus, I&#39;m including my Ansible plays to configure rsyslog for client log forwarding to Graylog.&lt;/p&gt;
&lt;p&gt;One note of warning: be prepared for Graylog&#39;s RAM consumption. Graylog is a RAM hog. You&#39;ll see your ram usage shoot up so it&#39;d pay to go into this project with your eyes open.&lt;/p&gt;
&lt;h3 id=&quot;details-of-the-vm-config&quot;&gt;Details of the VM Config&lt;/h3&gt;
&lt;p&gt;I went with a VM because Graylog is a bit of a beast, requiring multiple different components and lots of RAM. I believe people have installed it on LXC containers, but I figured I&#39;d run into fewer problems this way. Well, at least fewer problems than I would otherwise. Not absent problems.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;first&lt;/strong&gt; issue was relatively trivial but time consuming to figure out. I figured I&#39;d put Graylog on the latest Ubuntu LTS (24.04). It took a full install cycle using the &lt;a href=&quot;https://wiki.ubuntu.com/Installer/FAQ&quot;&gt;Ubuntu Debian-Installer&lt;/a&gt; and troubleshooting to realize that MongoDB wouldn&#39;t play nice with that version. MongoDB is required for Graylog&#39;s function so this wasn&#39;t something I could figure out later. Lesson learned. As of this writing, I used 22.04.&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;second&lt;/strong&gt; was that MongoDB&lt;a href=&quot;https://forum.proxmox.com/threads/mongo-db-5-0-not-install.95857/post-440005&quot;&gt; doesn&#39;t play nice with Proxmox&#39;s defaults&lt;/a&gt;. I had learned and subsequently forgotten this one from a previous encounter with MongoDB. In particular, I had to tweak an option that I otherwise never change regarding the processor, as MongoDB cannot work on the default selection of x86-64-v2-AES. In the VM creation guide, on the CPU tab, for &amp;quot;Type,&amp;quot; I had to set the processor to &lt;em&gt;host&lt;/em&gt; in order for it to function correctly in the VM.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2025-01-21_11-41.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;onward-to-the-logdom&quot;&gt;Onward to the Logdom&lt;/h3&gt;
&lt;p&gt;From there I followed &lt;a href=&quot;https://go2docs.graylog.org/current/downloading_and_installing_graylog/ubuntu_installation.htm#aanchor21&quot;&gt;the official docs &lt;/a&gt; for an Ubuntu install without problems.&lt;/p&gt;
&lt;h3 id=&quot;automating-client-rsyslog-configurations-with-ansible&quot;&gt;Automating Client Rsyslog Configurations with Ansible&lt;/h3&gt;
&lt;p&gt;Take what follows as a rough model rather than specific directions.&lt;/p&gt;
&lt;p&gt;Next, there was the matter of configuring my machines &lt;a href=&quot;https://go2docs.graylog.org/current/getting_in_log_data/syslog_inputs.html&quot;&gt;to send logs to Graylog&lt;/a&gt;. Graylog offers a &lt;a href=&quot;https://go2docs.graylog.org/current/getting_in_log_data/inputs.htm&quot;&gt;variety of different ways&lt;/a&gt; to accept logs from client machines. I went with Rsyslog.&lt;/p&gt;
&lt;p&gt;Now, I could have ssh-ed into each individual machine and altered the &lt;code&gt;/etc/rsyslog.conf&lt;/code&gt; file by hand to include:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;*.*@@yourgraylog.example.org:514;RSYSLOG_SyslogProtocol23Format
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;However, from the start this task seemed ripe for automation.&lt;/p&gt;
&lt;p&gt;I built an Ansible script to ensure rsyslog was installed and then to configure it on the clients. I&#39;d been playing around with Ansible over the weekend, and the YAML format is great compared to writing everything out in pure python.&lt;/p&gt;
&lt;p&gt;Be aware, while the Ansible code can be found below, there are a bunch of configuration challenges to Ansible that can sidetrack you for hours. I can think of at least two off the top of my head. First, I used the code below as an &lt;a href=&quot;https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html&quot;&gt;Ansible Role&lt;/a&gt;. Covering what that means, and how to setup Ansible, is far beyond the scope of this article. If you&#39;re new to it, plan some free hours to start toying around. Start with &lt;a href=&quot;https://docs.ansible.com/ansible/latest/getting_started/index.html&quot;&gt;the docs&lt;/a&gt;; they&#39;re just average but they&#39;re worth it for just getting started. Second, if you use &lt;em&gt;sudo&lt;/em&gt; with a password on the target, you&#39;ll want to use Ansible-Vault. However, the whole way Ansible Vault works is super unclear to me. I hope to write up a blog post about it sometime. I&#39;m afraid I don&#39;t have a confirmed solution for it as of this writing. Also, I can&#39;t help if you are thinking of windows hosts, I don&#39;t have windows clients.&lt;/p&gt;
&lt;p&gt;Because this is a role &lt;em&gt;main.yml&lt;/em&gt; file, it may seem truncated. To explain, the first section determines whether rsyslog is installed. The second determines whether the Graylog code for forwarding the logs is already present in the &lt;code&gt;/etc/rsyslog.conf&lt;/code&gt; file, and if not, adds it to the final line. The final section then restarts the rsyslog server.&lt;/p&gt;
&lt;pre class=&quot;language-yml&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Install rsyslog
  &lt;span class=&quot;token key atrule&quot;&gt;ansible.builtin.apt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rsyslog

&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Add instruction to dispatch logs to graylog
  &lt;span class=&quot;token key atrule&quot;&gt;ansible.builtin.lineinfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc/rsyslog.conf
    &lt;span class=&quot;token key atrule&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*.*@@YOUR_IP_HERE;RSYSLOG_SyslogProtocol23Format&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;regexp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;&#92;*.&#92;*@@YOUR_IP_HERE;RSYSLOG_SyslogProtocol23Format&#39;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; present
    &lt;span class=&quot;token key atrule&quot;&gt;insertafter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; EOF
    &lt;span class=&quot;token key atrule&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Restart rsyslog
  &lt;span class=&quot;token key atrule&quot;&gt;ansible.builtin.shell&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; systemctl restart rsyslog&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You&#39;d then run that using Ansible as a role in your playbook.&lt;/p&gt;
&lt;h3 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;Admittedly, this is a post with a niche attraction, but nevertheless I hope it may help someone in the future. Should you have any questions, don&#39;t hesitate to DM me on &lt;a href=&quot;https://infosec.exchange/@anthro_packets&quot;&gt;Mastodon&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Installing VSFTP in a Proxmox LXC Container Or: &quot;How I Learned the Lessons of the SysAdmin&quot;</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2025-01-07-vsftpd/" />
    <updated>2025-01-07T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2025-01-07-vsftpd/</id>
    <content type="html">&lt;p&gt;To make a long story short, I don&#39;t want my NAS to be multipurpose for reasons of admin. I only want it to be a backup server, nothing more. So I thought I&#39;d write up a quick primer on installing and configuring VSFTP in a Proxmox LXC container.&lt;/p&gt;
&lt;h3 id=&quot;a-progression-to-the-sysadmin-perspective&quot;&gt;A Progression to the SysAdmin Perspective&lt;/h3&gt;
&lt;p&gt;I don&#39;t think I have more services running than the next home-labatista on the block, but I do have an above average awareness of security and so I&#39;m assiduous about ensuring services are installed correctly, hardened, and everything from OS to apps are upgraded. That means that as the number of services I run grows, I find I&#39;m spending lots of time on admin. It&#39;s not that I don&#39;t like doing admin, its that I don&#39;t like doing lots of admin while being inefficient amidst growing workflows. As the VM and container workflows have multiplied, I&#39;ve looked to simplify things. While I&#39;m sure automation might help me here, I&#39;m seeking simplicity of a mental sort to start.&lt;/p&gt;
&lt;p&gt;After listening to &lt;a href=&quot;https://2.5admins.com/2-5-admins-178/&quot;&gt;2.5 Admins # 178&lt;/a&gt;, I&#39;ve taken the principle of having critical services running on dedicated hardware and extended it another step. I want non-hypervisor hardware, especially hardware running uncommon OSes such as Synology&#39;s Disk Station Manager, to be dedicated to only one service as a rule. If the appliance is designed as a network attached storage device, then let it be a backup server only. Running a slew of Docker containers across a Proxmox host, a Raspberry Pi and who knows what else is too taxing from a management standpoint. That is what Proxmox is for; let the Raspberry Pi run a Meshtastic node alone.&lt;/p&gt;
&lt;p&gt;I can see that I&#39;m privileged to have a NAS appliance and a separate hypervisor, allowing me to separate a backup server from, say, a media server, instead of using the NAS to simultaneously provide multiple services itself. All the same, at a cognitive level, I find it easier to manage many home-lab services when they are segregated according to hardware. Proxmox with its ease of management and easy backups can then handle the multipurpose role.&lt;/p&gt;
&lt;p&gt;Perhaps this is the journey all professional SysAdmins go through, from disorganization and shabby practices when they have a lone VM to keep up, to anticipation, planning, and automation when they manage a small fleet. Okay, yeah, maybe that is just me.&lt;/p&gt;
&lt;h3 id=&quot;why-ftp&quot;&gt;Why FTP?&lt;/h3&gt;
&lt;p&gt;In part, curiosity.  While working on my OSCP cert, it got to the point were I&#39;d groan anytime I fired up nmap and got a result with &amp;quot;vsftp&amp;quot; in the output.  It was almost never vulnerable.  And exploiting web vulnerabilities through exposed FTP shares came to be a tried and true path for initial webshell foothold.&lt;/p&gt;
&lt;p&gt;It&#39;s also partly a workflow preference.  I have PDF Expert on my Ipad, and FTPS has been the only consistently stable protocol I can use to connect to a file server where my PDFs are located.  I tried SMB for a spell, but my IOS seems to hate that protocol and regularly drops the connection. The only work around I could find was to refresh the connection by manually opening the remote share in the file browser.  FTPS by contrast has been hassel-free, so I&#39;m sticking with it for PDF reading on the tablet.&lt;/p&gt;
&lt;p&gt;Of course, I could just use SFTP and skip the work of setting up a dedicated FTP server, but then I wouldn&#39;t learn anything.  So, I installed Very Secure File Transfer Protocol Daemon (&lt;a href=&quot;https://security.appspot.com/vsftpd.html&quot;&gt;vsftpd&lt;/a&gt;) to handle file transfers on my LAN, and let my NAS be just about backups.&lt;/p&gt;
&lt;h3 id=&quot;lxc-container-creation&quot;&gt;LXC Container Creation&lt;/h3&gt;
&lt;p&gt;To be forthright, the &lt;a href=&quot;https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon&quot;&gt;Arch Wiki&lt;/a&gt; on vsftpd is concise and accurate if you need another reference. Credit where credit is due, I used that wiki, as well as the &lt;a href=&quot;https://wiki.debian.org/vsftpd&quot;&gt;Debian wiki&lt;/a&gt; and &lt;a href=&quot;https://help.ubuntu.com/community/vsftpd&quot;&gt;Ubuntu community page on vsftpd&lt;/a&gt; for the steps below.&lt;/p&gt;
&lt;p&gt;First, &lt;a href=&quot;https://pve.proxmox.com/wiki/Linux_Container&quot;&gt;create&lt;/a&gt; an LXC container. This should be straightforward, and it&#39;s out of scope to cover the steps to inception here. Broadly speaking, I prefer using Ubuntu LTS container templates so I don&#39;t get caught out in a year or two when some breaking change requires that I upgrade the distro before I can upgrade the software.&lt;/p&gt;
&lt;p&gt;I prefer SSH keys for admin, so that first tab is a place where I tend to create and add a public key. Regarding memory and CPU, I erred on the lower side of things, with 1 core, 2048 RAM and default storage. I didn&#39;t put this particular LXC on a VLAN, though if you&#39;ve already set up a VLAN bridge in Proxmox corresponding to your router&#39;s VLAN, then it is as simple as adding the VLAN tag in the networking tab.&lt;/p&gt;
&lt;h3 id=&quot;install-and-config-of-vsftpd&quot;&gt;Install &amp;amp; Config of VSFTPD&lt;/h3&gt;
&lt;p&gt;Installation is the easy part. For Debian or Ubuntu, you need only use &lt;code&gt;apt install vsftp&lt;/code&gt; to install using package manager.&lt;/p&gt;
&lt;p&gt;Before configuring, I changed the hosts file to specify connections only from an RFC 1918 IP address:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# Allow all connections
vsftpd: ALL
# IP address range
vsftpd: 10.0.0.0/255.255.255.0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The configuration of vsftp takes place through a file, &lt;code&gt;/etc/vsftpd.conf&lt;/code&gt;. Below are the options I selected. Your requirements may differ, so please refer to the &lt;a href=&quot;https://wiki.archlinux.org/title/Very_Secure_FTP_Daemon&quot;&gt;Arch Wiki&lt;/a&gt; on vsftpd for derivations.&lt;/p&gt;
&lt;p&gt;This config assumes that you&#39;ve assigned a system user as designated to access FTP, perhaps using &lt;code&gt;adduser SOME_NEW_USERNAME&lt;/code&gt;.  If at any point you can&#39;t find the entries below, simply add them to &lt;code&gt;vsftpd.conf&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Disallow anonymous login:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;anonymous_enable=NO
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Allowing uploading:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;write_enable=YES
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Chroot users by default, ensuring they can&#39;t access whole file system:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chroot_local_user=YES 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;chroot_list_enable=NO
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Make sure the user&#39;s home directory has the following permissions in accordance with the chroot:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod a-w /home/SOME_NEW_USERNAME
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;chmod 555 /home
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you can create folders under that user that will: be writable for the FTP server.&lt;/p&gt;
&lt;p&gt;Then, set the FTP user&#39;s shell to false:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;usermod -s /bin/false SOME_NEW_USERNAME
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You need to add that false shell to the shells list :&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;echo /bin/false &amp;gt;&amp;gt; /etc/shells
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Add TLS by first creating a self-signed cert for FTPS:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /etc/ssl/certs
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout vsftpd.pem -out vsftpd.pem
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;chmod 600 vsftpd.pem
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then add the following to &lt;code&gt;/etc/vsftpd.conf&lt;/code&gt; to take advantage of that new certificate:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssl_enable=YES

# if you accept anonymous connections, you may want to enable this setting
#allow_anon_ssl=NO

# by default all non anonymous logins and forced to use SSL to send and receive password and data, set to NO to allow non secure connections
force_local_logins_ssl=NO
force_local_data_ssl=NO

# TLS v1 protocol connections are preferred and this mode is enabled by default while SSL v2 and v3 are disabled
# the settings below are the default ones and do not need to be changed unless you specifically need SSL
#ssl_tlsv1=YES
#ssl_sslv2=NO
#ssl_sslv3=NO

# provide the path of your certificate and of your private key
# note that both can be contained in the same file or in different files
rsa_cert_file=/etc/ssl/certs/vsftpd.pem
rsa_private_key_file=/etc/ssl/certs/vsftpd.pem

# this setting is set to YES by default and requires all data connections exhibit session reuse which proves they know the secret of the control channel.
# this is more secure but is not supported by many FTP clients, set to NO for better compatibility
require_ssl_reuse=NO
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That should be it. You can check the status is &lt;em&gt;enabled&lt;/em&gt; and &lt;em&gt;active&lt;/em&gt; by running:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;systemctl status vsftpd.service
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can then confirm by ftp-ing in from another machine (you might have to install first: &lt;code&gt;apt install ftp&lt;/code&gt;). Get the IP address of the vsftp server (&lt;code&gt;ip a&lt;/code&gt;) and try to log in with the system user&#39;s creds:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ftp SOME_VSFTP_SERVER
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For troubleshooting, if you get an error like &amp;quot;500 OOPS: vsftpd: refusing to run with writable root inside chroot(),&amp;quot; then look into the permissions on the home folder of user you set up for access.&lt;/p&gt;
&lt;h3 id=&quot;wrap-up&quot;&gt;Wrap Up&lt;/h3&gt;
&lt;p&gt;There you have it, a very secure FTP server to integrate with all your file reader/clients on the local network. Of course you can set up Tailscale if you&#39;d like to offer it up while away from your LAN, as that would be vastly preferable to opening up ports on your router.&lt;/p&gt;
&lt;p&gt;In any event, I hope this helped, and best of luck in whatever computing journey you find yourself on.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Quick Pointer: Abusing DACL Fumbles using PowerView</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-12-12-pv-dacl-mods/" />
    <updated>2024-12-12T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-12-12-pv-dacl-mods/</id>
    <content type="html">&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-12-11_10-09.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Ever come across an edge description in Boodhound on DACL abuse? They tend to look something like the above.
&lt;p&gt;The Windows abuse instructions on the edge tend to offer two ways to proceed, either using &lt;em&gt;net group&lt;/em&gt; from net.exe or PowerView. I&#39;ve always used the net.exe method, but they recommend PowerView because the opsec for net.exe is challenging.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-12-12_08-59.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
I was curious to play around with PowerView&#39;s _Add-DomainGroupMember_ to have another option in my toolbox and find out more about this improved opsec. Unfortunately, I&#39;ve run into this Bloodhound description enough times to know that the steps for the PowerView method aren&#39;t quite as clearly laid out in the Bloodhound description as they could be. I don&#39;t think it&#39;s Bloodhound&#39;s fault, as the [original instructions](https://powersploit.readthedocs.io/en/latest/Recon/Add-DomainGroupMember/) aren&#39;t effusive by any means.
&lt;h2 id=&quot;adding-an-existing-user-to-domain-admins-by-modifying-the-dacl&quot;&gt;Adding an Existing User to Domain Admins by Modifying the DACL&lt;/h2&gt;
&lt;p&gt;To make it clearer, here are the steps to follow on a compromised domain-joined target. This will add an existing user (for which you have obtained a password), who already has DACL privileges over the Domain Admins group, to the Domain Admins group itself. For the sake of this example, lets say the user credentials we&#39;ve compromised and want to add to Domain Admins is &lt;code&gt;paul.atreides:spicyworm&lt;/code&gt; on a domain with a short name of &lt;em&gt;arrakis&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;First, it might pay to ensure you&#39;re authenticated to the Domain Controller as a member of the domain. Set up the creds as variables in Powershell and then use &lt;em&gt;Add-DomainObjectAcl&lt;/em&gt; to authenticate.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$SecPassword = ConvertTo-SecureString &#39;spicyworm&#39; -AsPlainText -Force
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;$Cred = New-Object System.Management.Automation.PSCredential(&#39;arrakis&#92;paul.atreides&#39;, $SecPassword)
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;Add-DomainObjectAcl -Credential $Cred -TargetIdentity &amp;quot;Domain Admins&amp;quot; -PrincipalIdentity paul.atreides -Rights WriteMembers
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I&#39;m no PowerShell expert, but you probably don&#39;t need to reenter the following two variables again. I&#39;m doing so for the sake of effectiveness.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$SecPassword = ConvertTo-SecureString &#39;spicyworm&#39; -AsPlainText -Force
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;$Cred = New-Object System.Management.Automation.PSCredential(&#39;arrakis&#92;paul.atreides&#39;, $SecPassword)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now add the existing domain user, paul.atreides, who has DACL privileges over Domain Admins group, to the Domain Admins group.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Add-DomainGroupMember -Identity &#39;Domain Adims&#39; -Members &#39;paul.atreides&#39; -Credential $Cred
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you can verify whether the operation succeeded.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Get-DomainGroupMember -Identity &#39;Domain Admins&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;moving-forward&quot;&gt;Moving Forward&lt;/h2&gt;
&lt;p&gt;If successful, from there your options should open up a bit to lateral movement, or obtaining hashes among other possibilities.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 6 - OpenVPN</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-23-goad-vpn/" />
    <updated>2024-11-23T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-23-goad-vpn/</id>
    <content type="html">&lt;p&gt;This is part 6 of my series on &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE. In the &lt;a href=&quot;https://christopherbauer.org/2024/11/18/goad-ansible.html&quot;&gt;fifth installment&lt;/a&gt; I covered how to use Ansible to configure the final domain layout and individual Windows VMs. In this post we&#39;ll setup the VPN server on pfSense to simulate an assumed breach.&lt;/p&gt;
&lt;p&gt;As I mentioned before, I&#39;m deeply indebted to Mayfly277&#39;s &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;canonical guide&lt;/a&gt;, and this post follows Mayfly277&#39;s work closely to provide readers with a resource to be used as a standalone or as a supplement.&lt;/p&gt;
&lt;p&gt;Should you need more orientation to the context of this series, or on my rationale for creating it, see &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;first post&lt;/a&gt; in this series.&lt;/p&gt;
&lt;p&gt;Mayfly277&#39;s instructions for this VPN section left me scratching my head at various points. I found two steps where my setup would fail if I followed his instructions on my machine. I&#39;ll make note of those deviations in what follows.&lt;/p&gt;
&lt;h2 id=&quot;pfsense-and-openvpn&quot;&gt;pfSense &amp;amp; OpenVPN&lt;/h2&gt;
&lt;h3 id=&quot;creating-the-ca&quot;&gt;Creating the CA&lt;/h3&gt;
&lt;p&gt;One note before we start, Mayfly277&#39;s &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;guide&lt;/a&gt; has some helpful graphics on his screenshots to draw your eye directly to what needs modifying. Should you get confused about what needs modifying in the following steps, head over there and you should be able to sort it out quickly.&lt;/p&gt;
&lt;p&gt;The first step involves creating a certificate authority to issue a certificate. Go to the system menu and select the Certificates option.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-23_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-23.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Under the Authorities tab click the green Add button at the bottom, and it&#39;ll take to to the following page where you&#39;ll give a descriptive name and a common name. I&#39;ve used VLAN 30 (this is according to my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;unique arrangement&lt;/a&gt;, if you followed Mayfly277&#39;s instructions you&#39;d use 10).&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-24.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Click save and you should have something like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-25.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;create-the-certificate-server&quot;&gt;Create the Certificate Server&lt;/h3&gt;
&lt;p&gt;Click the Certificates tab, and click the green Add button at the bottom. That&#39;ll bring up the new certificate page where you&#39;ll add:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add a decriptive name&lt;/li&gt;
&lt;li&gt;Select the CA you created&lt;/li&gt;
&lt;li&gt;Set lifetime to 3650&lt;/li&gt;
&lt;li&gt;Add a common name&lt;/li&gt;
&lt;li&gt;Select the server certificate type&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Then save.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-25_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-27.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-27_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once you save the Certificates page will look like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-28.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;create-a-vpn-user&quot;&gt;Create a VPN User&lt;/h3&gt;
&lt;p&gt;Now we&#39;ll create a local user who can access the VPN. Go to the System menu and select User Manager.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-28_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Under the Users tab, select the green Add button to create a new user.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-28_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Select a username and password, a descriptive name for the user certificate and select the CA you created.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-30.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once you hit save the user page will look like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-31.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;create-the-open-vpn-service&quot;&gt;Create the Open VPN Service&lt;/h3&gt;
&lt;p&gt;Now we&#39;ll create the service operating on the server. Go to the VPN menu and select OpenVPN.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-31_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Under the Servers tab, click on the Green add button. You&#39;ll make several modifications on this page. The first set are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Change the description&lt;/li&gt;
&lt;li&gt;Change Server mode to &amp;quot;Remote Access (SSL/TLS + User Auth)&amp;quot;&lt;/li&gt;
&lt;li&gt;Enter &amp;quot;Local Database&amp;quot; into the Backend for authentication field&lt;/li&gt;
&lt;li&gt;Change the local port to 2137&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-32.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Modifications continued:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Change Peer Certificate Authority to the CA you created&lt;/li&gt;
&lt;li&gt;Change Server certificate to the certificate you created&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-33.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Modifications continued:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Change IPv4 Tunnel Network to 10.10.10.0/24&lt;/li&gt;
&lt;li&gt;Change IPv4 Local network to 192.168.30.0/24&lt;/li&gt;
&lt;li&gt;Change concurent connections to 10&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-34.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Modifications continued:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Add the network configuration in the Topology dropdown to &amp;quot;net30 -- Isolated /30 network per client&amp;quot;&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-35.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally, make sure:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DNS Server Enabled is checked&lt;/li&gt;
&lt;li&gt;DNS server 1 reads 192.168.30.1 (this is according to my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;unique arrangement&lt;/a&gt;, if you followed Mayfly277&#39;s instructions you&#39;d use 10)&lt;/li&gt;
&lt;li&gt;That the Custom options field under Advanced Configruation reads &amp;quot;auth-nocache&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-36.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-36_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;openvpn-client-export-package&quot;&gt;OpenVPN Client Export Package&lt;/h3&gt;
&lt;p&gt;Now we&#39;ll search for and install the OpenVPN package for Client Export that&#39;ll add a new tab to the OpenVPN pages. Go to System and then Package Manager.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-37.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Enter &amp;quot;client-export&amp;quot; into the search term and click the green install button on the entry named &amp;quot;openvpn-client-export.&amp;quot;&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-37_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-37_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Next click the client export tab.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-38.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That&#39;ll bring up a new page where we&#39;ll create the VPN certificate for export.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_13-47.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This section of Mayfly277&#39;s guide was not clear on configuring the client export step. When mayfly277 says change the Host Name Resolution to &amp;quot;Other&amp;quot; in the exporting the client certificate step, there is a blurred image. In the context of these posts, where we&#39;re installing GOAD on a bare-metal instance of Proxmox with an existing true LAN, so we&#39;ll use &lt;em&gt;the IP of the Proxmox host&lt;/em&gt; for &amp;quot;Host Name.&amp;quot;&lt;/p&gt;
&lt;p&gt;Once you&#39;ve done that, scoll to the bottom section OpenVPN clients and click under the Export column &amp;quot;Inline Configurations - Most Clients.&amp;quot; Download that certificate to your Kali/attack machine.&lt;/p&gt;
&lt;h3 id=&quot;enable-the-ovpns1-interface&quot;&gt;Enable the ovpns1 Interface&lt;/h3&gt;
&lt;p&gt;At this point there seemed to be something missing from Mayfly277&#39;s instructions. I eventually pieced together that I needed to enable the goadvpn interface with the help of &lt;a href=&quot;https://koller.ninja/proxmox-goad-lab&quot;&gt;this blog&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Head to the Interfaces menu and select assignments. There should now be an entry there called &amp;quot;goadvpn,&amp;quot; click on that blue name/link on the left side. That&#39;ll open up its page and make sure the Enable Interface box is checked, then change the description and click the green Apply Changes box that comes up.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_14-18.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Your interface assignments will then look something like this:
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_14-18_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You&#39;ll want to enable this interface before you get to the &amp;quot;Configure Firewall&amp;quot; steps.&lt;/p&gt;
&lt;h3 id=&quot;firewall-rules-review&quot;&gt;Firewall Rules Review&lt;/h3&gt;
&lt;p&gt;Honestly, the most challanging part of setting up GOAD was configuring the firewall rules, so take this review of my rules with a grain of salt. These work for me, but they took quite a bit of tinkering. I&#39;m not an expert at firewall rules, so if you spot an error, please let me know by direct messaging me on Mastodon.&lt;/p&gt;
&lt;p&gt;The WAN rules:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_14-03.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The LAN rules:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-23_10-18.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The VLAN rules:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_14-24.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The VPN rules:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-17_14-37.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Post-series edit:&lt;/em&gt; After writing up this series up and exploring on my own, I discovered that VLAN machines couldn&#39;t access the internet.  As a consquence, I couldn&#39;t make them call on my server to download payloads.  I looked into it, and as mentioned in &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/issues/177#issuecomment-1927681503&quot;&gt;this github issue&lt;/a&gt;, I think a rule is missing from the VLAN firewall.  To remedy the problem, I tried a number of targeted rules that essentially reversed the OVPN rule, to no effect. As a short-term workaround, I created an allow any any rule.  My VLAN rules are now kind of a mess, see below.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-12-04_13-38.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;confirming-vpn-access-to-the-domain&quot;&gt;Confirming VPN Access to the Domain&lt;/h2&gt;
&lt;p&gt;Now use &lt;code&gt;sudo openvpn &amp;lt;YOUR_CERTIFICATE&amp;gt;&lt;/code&gt; to connect, and it&#39;ll prompt you for the user and password you created. Once you do that, it should connect successfully.&lt;/p&gt;
&lt;p&gt;To confirm you can reach the VLAN from your attacking machine, use NetExec to do a simple SMB sweep without a domain:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nxc smb 192.168.&amp;lt;YOUR_VLAN&amp;gt;.&amp;lt;HERE&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-23_10-09.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;concluding-the-series&quot;&gt;Concluding the Series&lt;/h2&gt;
&lt;p&gt;With that, you&#39;ve confirmed that the domain is working and appropriately configured. You&#39;re now ready to pentest against the domain!&lt;/p&gt;
&lt;p&gt;It&#39;s been a pleasure writing this up, and I hope someone finds it helpful.  If you do, please don&#39;t hesitate to leave me a note at Mastodon.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 5 - Ansible</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-17-goad-ansible/" />
    <updated>2024-11-18T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-17-goad-ansible/</id>
    <content type="html">&lt;p&gt;This is part 5 of my series on &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE. In the &lt;a href=&quot;https://christopherbauer.org/2024/11/17/goad-terraform.html&quot;&gt;fourth installment&lt;/a&gt; I covered how to use Terraform to create the Windows VMs. In this post we&#39;ll configure the individual Windows VMs using Ansible to create the final GOAD topology.&lt;/p&gt;
&lt;p&gt;As I mentioned before, I&#39;m deeply indebted to Mayfly277&#39;s &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;canonical guide&lt;/a&gt;, and this post follows Mayfly277&#39;s work closely to provide readers with a resource to be used as a standalone or as a supplement.&lt;/p&gt;
&lt;p&gt;Should you need more orientation to the context of this series, or on my rationale for creating it, see &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;first post&lt;/a&gt; in this series.&lt;/p&gt;
&lt;h2 id=&quot;configuring-the-ad-vms&quot;&gt;Configuring The AD VMs&lt;/h2&gt;
&lt;h3 id=&quot;preparation&quot;&gt;Preparation&lt;/h3&gt;
&lt;h4 id=&quot;modify-the-inventory&quot;&gt;Modify the Inventory&lt;/h4&gt;
&lt;p&gt;On the provisioner, there should be an &lt;em&gt;inventory&lt;/em&gt; file as part of the cloned GOAD repo. Change to that directory so that you can modify it.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd ~/GOAD/ad/GOAD/providers/proxmox
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the inventory I changed the static IPs of the five machines to reflect the VLAN subnet they were on (this according to my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;unique arrangement&lt;/a&gt;, if you followed Mayfly277&#39;s instructions this step will be unnecessary).&lt;/p&gt;
&lt;p&gt;At this point Mayfly277 suggests &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part4-ansible/#install-the-requirements&quot;&gt;installing the requirements for ansible-galaxy&lt;/a&gt;. In my guide, we completed that step as part of &lt;a href=&quot;https://christopherbauer.org/2024/11/11/provisioner.html&quot;&gt;the provisioner setup&lt;/a&gt;, so we&#39;re now ready to run Ansible&#39;s playbook.&lt;/p&gt;
&lt;h2 id=&quot;run-ansible&quot;&gt;Run Ansible&lt;/h2&gt;
&lt;p&gt;To configure the machines, switch to the Ansible directory on the provisioner and run the playbook.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/ansible
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;export ANSIBLE_COMMAND=&amp;quot;ansible-playbook -i ../ad/GOAD/data/inventory -i ../ad/GOAD/providers/proxmox/inventory&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If all goes according to plan, it will cover a lot of ground and say &amp;quot;command successfully executed.&amp;quot;&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-29_19-13.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This wasn&#39;t the case during my installation, I ran into multiple problems. Before I dig into those, remember that if you need to come back to the project after a restart of the provisioner, you might have to source the python packages again according to the &lt;a href=&quot;https://christopherbauer.org/2024/11/11/provisioner.html&quot;&gt;virtual environment&lt;/a&gt; we set up in part 2.&lt;/p&gt;
&lt;h3 id=&quot;troubleshooting-the-ansible-run&quot;&gt;Troubleshooting the Ansible Run&lt;/h3&gt;
&lt;p&gt;I ran into errors in attempting to complete the entire Ansible run. Ultimately, I was able to complete the run successfully. I just troubleshooted the error messages and re-ran until the run completed. Adding &lt;code&gt;-vvv&lt;/code&gt; might help add verbosity for revealing error messages if you need to troubleshoot, and the &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/issues&quot;&gt;issues section&lt;/a&gt; of Orange-Cyberdefense&#39;s Github Repo was very helpful.&lt;/p&gt;
&lt;p&gt;There is quite a lot to the Ansible playbook, so if you troubleshoot and successfully resolve, you&#39;ll have to run again and sit tight for a while as it proceeds.&lt;/p&gt;
&lt;h4 id=&quot;failed-to-get-smbios-buffer-information&quot;&gt;&amp;quot;Failed to get SMBIOS buffer information... &amp;quot;&lt;/h4&gt;
&lt;p&gt;The first time I ran Ansible, I received an error similar to &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/issues/177&quot;&gt;this thread&lt;/a&gt;. I eventually got it working after a Proxmox reboot and temporarily taking out all the VLAN30 rules while adding a single allow any any rule. I was unable to determine what specifically caused the error.&lt;/p&gt;
&lt;h4 id=&quot;add-a-domain-user-group-from-another-domain&quot;&gt;&amp;quot;Add a domain user/group from another Domain...&amp;quot;&lt;/h4&gt;
&lt;p&gt;Next I had to troubleshoot again on the &amp;quot;Add a domain...&amp;quot; error for DC03. I eventually ran across &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/issues/58#issuecomment-1558976147&quot;&gt;this fix&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;create-snapshots&quot;&gt;Create Snapshots&lt;/h2&gt;
&lt;p&gt;Once the Ansible run is successful, we&#39;re done creating the GOAD topology and settings, so it&#39;s a good time to take snapshots so that we may easily revert the machines to a clean state after our penetration testing.&lt;/p&gt;
&lt;p&gt;Mayfly277 offers &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part4-ansible/#create-snapshots&quot;&gt;a bevy of bash variables and a for loop&lt;/a&gt; to create snapshots of the newly configured machines on the Proxmox command line. This is the faster way, though you can take snapshots manually by going to each of the five machines in the web user interface (WUI) and selecting the Snapshots option in the middle menu column and the &amp;quot;Take Snapshot&amp;quot; button.&lt;/p&gt;
&lt;h2 id=&quot;configuration-complete&quot;&gt;Configuration Complete&lt;/h2&gt;
&lt;p&gt;That wraps up the deployment section. Next we&#39;ll configure a vpn tunnel allowing us to connect an attacking machine to the internal network.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 4 - Terraform</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-17-goad-terraform/" />
    <updated>2024-11-17T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-17-goad-terraform/</id>
    <content type="html">&lt;p&gt;This is part 4 of of my series on &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE. In the &lt;a href=&quot;https://christopherbauer.org/2024/11/14/templates.html&quot;&gt;third installment&lt;/a&gt; I covered preparing templates and creating them in packer in preparation of creating the GOAD machines. In this post we&#39;ll deploy the domain and its machines using Terraform.&lt;/p&gt;
&lt;p&gt;As I mentioned before, I&#39;m deeply indebted to Mayfly277&#39;s &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;canonical guide&lt;/a&gt;, and this post follows Mayfly277&#39;s work closely to provide readers with a resource to be used as a standalone or as a supplement.&lt;/p&gt;
&lt;p&gt;Should you need more orientation to the context of this series, or on my rationale for creating it, see &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;first post&lt;/a&gt; in this series.&lt;/p&gt;
&lt;h2 id=&quot;preparation&quot;&gt;Preparation&lt;/h2&gt;
&lt;h3 id=&quot;proxmox&quot;&gt;Proxmox&lt;/h3&gt;
&lt;p&gt;First, as Mayfly277 says, &amp;quot;we will go dirty&amp;quot; by giving admin privileges to the user we created in &lt;a href=&quot;https://christopherbauer.org/2024/11/14/templates.html&quot;&gt;part 3&lt;/a&gt;. On the command line of the Proxmox machine, change the infra_as_code user&#39;s privileges to admin.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;pveum acl modify / -user &#39;infra_as_code@pve&#39; -role Administrator
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;specifying-terraform-variables&quot;&gt;Specifying Terraform Variables&lt;/h3&gt;
&lt;h4 id=&quot;variables-tf&quot;&gt;Variables.tf&lt;/h4&gt;
&lt;p&gt;Next we&#39;re going to set up a Terraform file with some initial variables for the build on the provisional machine.&lt;/p&gt;
&lt;p&gt;Log on to the provisioner.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssh goadprovisioner
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Make an active copy of the Terraform variables file.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/ad/GOAD/providers/proxmox/terraform
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;cp variables.tf.template variables.tf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Next we&#39;ll modify the file to our specifications. Mayfly277 &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part3-terraform/#configure-terraform&quot;&gt;lays out the full specifications&lt;/a&gt; in the code, so rather than reproduce the entire file, I&#39;ll simply review what I changed. I had to modify the following in the variables.tf file.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the vlan tag (according to my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;unique arrangement&lt;/a&gt;, yours may differ)&lt;/li&gt;
&lt;li&gt;node name&lt;/li&gt;
&lt;li&gt;gateway address&lt;/li&gt;
&lt;li&gt;password&lt;/li&gt;
&lt;li&gt;storage&lt;/li&gt;
&lt;li&gt;id numbers for the vms created&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;goad-tf&quot;&gt;Goad.tf&lt;/h4&gt;
&lt;p&gt;Now we&#39;ll modify the goad.tf file in the same directory.&lt;/p&gt;
&lt;p&gt;I had to modify that file under the section starting with &lt;em&gt;&lt;code&gt;variable &amp;quot;vm_config&amp;quot;&lt;/code&gt;&lt;/em&gt;. I changed the static IPs of the five machines to reflect the VLAN subnet they were on (according to my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;unique arrangement&lt;/a&gt;, if you followed Mayfly277&#39;s instructions this step will be unnecessary).&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_15-37.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;deploy-the-ad-vms&quot;&gt;Deploy the AD VMs&lt;/h2&gt;
&lt;p&gt;Now we&#39;re ready to create the VM&#39;s using Terraform. We&#39;ll first initialize, then run a plan to create an output for the Terraform run.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;terraform init
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;terraform plan -out goad.plan
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we&#39;ll run the Terraform plan. Mayfly277 reports this took 25 minutes. That seems about what mine took. Also, I did have to run it more than once, but ultimately it did work.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;terraform apply &amp;quot;goad.plan&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you should see five new VMs withe the names you specified in goad.tf in the Proxmox web user interface.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-14_15-16.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Troubleshooting note: if you find that it takes an unacceptably long time to complete the Terraform build, ask yourself what storage you selected in &lt;a href=&quot;https://christopherbauer.org/2024/11/14/templates.html&quot;&gt;part 3&lt;/a&gt; when you modified the config.auto.pkrvars.hcl file. If it wasn&#39;t local-lvm, that might have something to do with it.&lt;/p&gt;
&lt;h2 id=&quot;deployment-complete&quot;&gt;Deployment Complete&lt;/h2&gt;
&lt;p&gt;That wraps up the deployment section. Next we&#39;ll configure the AD machines using Ansible.&lt;/p&gt;
&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;Mayfly277&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD&quot;&gt;GitHub Repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&amp;quot; &amp;quot; &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/blob/main/docs/install_with_proxmox.md&quot;&gt;proxmox instructions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 3 - Templating</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-14-templates/" />
    <updated>2024-11-14T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-14-templates/</id>
    <content type="html">&lt;p&gt;This is Part 3 of my series on &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE.  In the &lt;a href=&quot;https://christopherbauer.org/2024/11/11/provisioner.html&quot;&gt;second installment&lt;/a&gt; I covered creating a provisioner machine in Proxmox and installing Packer, Terraform and Ansible in preparation of creating the GOAD machines.  In this post we&#39;ll create templates  for future deployment of the individual AD DCs and servers.&lt;/p&gt;
&lt;p&gt;As I mentioned before, I&#39;m deeply indebted to &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;Mayfly277&#39;s canonical guide&lt;/a&gt;, and this post follows Mayfly277&#39;s work closely to provide readers with a resource to be used as a standalone or as a supplement to Mayfly277&#39;s guide.&lt;/p&gt;
&lt;p&gt;Should you need more orientation to the context of this series, or on my rationale for creating it, see the &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;first post in this series&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;preparation&quot;&gt;Preparation&lt;/h2&gt;
&lt;h3 id=&quot;obtain-the-windows-isos&quot;&gt;Obtain the Windows ISOs&lt;/h3&gt;
&lt;p&gt;First we&#39;ll need to obtain the Windows ISOs to serve as the basis of the templates.  Mayfly277 helpfully identified &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part2-packer/#download-the-isos&quot;&gt;registration-free&lt;/a&gt; links to those ISOs, so I recommend going directly to his guide for those links.  You can either download them to your local machine and subsquently upload them to Proxmox, or you can download them directly to Proxmox in the web user interface (WUI).&lt;/p&gt;
&lt;h3 id=&quot;obtain-the-cloudbase-init&quot;&gt;Obtain the Cloudbase-init&lt;/h3&gt;
&lt;p&gt;Returning to the provisioner machine, download the cloudbase-init service files to initialize and configure the Windows machines.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/packer/proxmox/scripts/sysprep 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;wget https://cloudbase.it/downloads/CloudbaseInitSetup_Stable_x64.msi
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_11-01.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;create-a-user-in-proxmox&quot;&gt;Create a User in Proxmox&lt;/h3&gt;
&lt;p&gt;We need to create a dedicated user for the steps that follow.  Mayfly277 suggests two options, either a user with limited privileges or a user with admin privileges.  I was ultimately forced to add admin privileges as I got the 403 error that Mayfly277 mentioned in their guide.  Ordinarily I&#39;d advise against giving admin privileges out unless absolutely necessary, but in this case Mayfly277 himself uses admin privileges in later steps, so it may make sense to implement them here.  In any event, I&#39;ll add both privileged and non-privileged options. Admin privileges are outlined in the last command below.&lt;/p&gt;
&lt;p&gt;To create the user and packer privileges, on the Proxmox command line enter the following commands in sequence.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;pveum useradd infra_as_code@pve
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;pveum passwd infra_as_code@pve
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;pveum roleadd Packer -privs &amp;quot;VM.Config.Disk VM.Config.CPU VM.Config.Memory Datastore.AllocateTemplate Datastore.Audit Datastore.AllocateSpace Sys.Modify VM.Config.Options VM.Allocate VM.Audit VM.Console VM.Config.CDROM VM.Config.Cloudinit VM.Config.Network VM.PowerMgmt VM.Config.HWType VM.Monitor SDN.Use&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then choose the sort of role you want the user to have.&lt;/p&gt;
&lt;p&gt;To create a user with only the packer privileges of the command above, enter:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;pveum acl modify / -user &#39;infra_as_code@pve&#39; -role Packer
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If instead you want to create a user with full admin privileges, enter:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;pveum acl modify / -user &#39;infra_as_code@pve&#39; -role Administrator
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;modifying-config-auto-pkrvars-hcl&quot;&gt;Modifying config.auto.pkrvars.hcl&lt;/h3&gt;
&lt;p&gt;On the provisioner machine change to &lt;code&gt;/root/GOAD/packer/proxmox/&lt;/code&gt; and copy the config.auto.pkrvars.hcl template file to a version for our use.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cp config.auto.pkrvars.hcl.template config.auto.pkrvars.hcl
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I next used a little trial and error to follow Mayfly277&#39;s instructions on modifying config.auto.pkrvars.hcl.  Mayfly277 says &amp;quot;&lt;em&gt;The config.auto.pkrvars.hcl file will contain all the informations [sic] needed by packer to contact the proxmox api.&lt;/em&gt;&amp;quot;  To interpret that a bit, I changed the following in the file:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;quot;proxmox_url&amp;quot; -&amp;gt; I set this to the gateway of GOAD LAN &lt;code&gt;192.168.2.1:8006&lt;/code&gt; so that it&#39;d be translated by NAT to Proxmox as we completed in &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;part 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&amp;quot;proxmox_username&amp;quot; -&amp;gt; change this to the user you created above&lt;/li&gt;
&lt;li&gt;&amp;quot;proxmox_password&amp;quot; -&amp;gt; change this to the user you created above&lt;/li&gt;
&lt;li&gt;&amp;quot;proxmox_node&amp;quot; -&amp;gt; changed to the name of the home Proxmox node&lt;/li&gt;
&lt;li&gt;&amp;quot;proxmox_vm_storage&amp;quot; -&amp;gt; storage for the machines you&#39;ll create&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;creating-custom-isos-for-the-template&quot;&gt;Creating Custom ISOs for the Template&lt;/h3&gt;
&lt;p&gt;For this step we&#39;ll create an ISO file for use with the template through a custom script that is located in the GOAD repository on the provisioner machine.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/packer/proxmox/
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;./build_proxmox_iso.sh
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Mayfly277 &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part2-packer/#prepare-iso-files&quot;&gt;describes what&#39;s going on&lt;/a&gt; with the script and understands it far better than I do.  If you&#39;d like to understand the inner workings before running it, head over &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part2-packer/#prepare-iso-files&quot;&gt;there&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Once the script runs and the ISO file has been created, we&#39;ll transfer it to Proxmox with scp.  For this step, Mayfly277 remarks &amp;quot;&lt;em&gt;the cloudinit iso file is pretty large we will copy it from the proxmox ssh access&lt;/em&gt;.&amp;quot;  However, if you set up key-only access to the provisioner in the &lt;a href=&quot;https://christopherbauer.org/2024/11/11/provisioner.html&quot;&gt;previous post in this series&lt;/a&gt;, you won&#39;t be able to use scp.  You can do the unthinkable and transfer the private key you use to access the provisioner container to your Proxmox host in order to do this.  But that&#39;d be a bad habit to get into, even if only on your LAN. It may be better practice to simply set up a password for SSH on the provisioner container.&lt;/p&gt;
&lt;p&gt;To transfer using scp and a password, enter the Proxmox command line.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssh goadproxmox
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;scp &amp;lt;SOME_PROXMOX_USER&amp;gt;@&amp;lt;SOME_PROXMOX_IP&amp;gt;:/root/GOAD/packer/proxmox/iso/scripts_withcloudinit.iso /var/lib/vz/template/iso/scripts_withcloudinit.iso
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now SSH into your Proxmox machine and download the &lt;a href=&quot;https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso&quot;&gt;virtio-win.iso&lt;/a&gt; file that has drivers for Windows VMs hosted on Linux hypervisors.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /var/lib/vz/template/iso 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;wget https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With that you should have ISOs named &amp;quot;scripts_withcloudinit.iso&amp;quot; and &amp;quot;virtio-win.iso&amp;quot; visible in your Proxmox WUI storage.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-11_10-14.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;modifying-packer-pkr-hcl&quot;&gt;Modifying packer.pkr.hcl&lt;/h3&gt;
&lt;p&gt;Mayfly277 says &amp;quot;&lt;em&gt;A generic packer.pkr.hcl file is present in GOAD folder&lt;/em&gt; .&amp;quot;  That path is &lt;code&gt;/root/GOAD/packer/proxmox/packer.json.pkr.hcl&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I modified the packer.pkr.hcl file so that the &amp;quot;vlan_tag&amp;quot; entry read &amp;quot;30&amp;quot; according to how I set up the networking in my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;first post&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&quot;modifying-the-individual-computer-config-files&quot;&gt;Modifying the Individual Computer Config Files&lt;/h3&gt;
&lt;p&gt;Next we&#39;ll modify the packer files for the individual templates.  Before we begin, it&#39;d be helpful to have the sha256 hashes for a couple of dependent files referenced in the packer files.  To collect those, head to the provisioner machine.&lt;/p&gt;
&lt;p&gt;On the provisioner, change directories, and note the hashes produced by the following commands:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/packer/proxmox/iso
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;sha256sum Autounattend_winserver2016_cloudinit.iso
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;sha256sum Autounattend_winserver2019_cloudinit.iso
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we&#39;ll modify the packer files, starting with the 2016 .hcl file:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root/GOAD/packer/proxmox
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use your favorite text editor to open &lt;code&gt;windows_server2016_proxmox_cloudinit.pkvars.hcl&lt;/code&gt; (I use vi/vim).&lt;/p&gt;
&lt;p&gt;I left most settings in that file alone.  Do enter the hash you derived for the Autounattend_winserver2016_cloudinit.iso into the field &amp;quot;autounattend_checksum&amp;quot;.  I also had an issue when running Packer in the next step where the error message mentioned no file type.  Eventually I appended the following line to make it work:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;vm_disk_format = &amp;quot;qcow2&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then do the same process but using the second hash for the file windows_server2019_proxmox_cloudinit.pkvars.hcl.&lt;/p&gt;
&lt;p&gt;Here are the specs for the two files that I ended up with.  The 2016 .hcl file appears below as the first screenshot, and the 2019 .hcl file appears below as the second.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-11_10-23.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-11_10-23_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;create-the-templates&quot;&gt;Create the Templates&lt;/h2&gt;
&lt;p&gt;Now we&#39;re ready to launch the packer template builds for the 2016 and 2019 templates that will later be used to create the VMs.&lt;/p&gt;
&lt;p&gt;Initialize packer,&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;packer init .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Validate the file, and then build for each respectively.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;packer validate -var-file=windows_server2019_proxmox_cloudinit.pkvars.hcl .
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;packer build -var-file=windows_server2019_proxmox_cloudinit.pkvars.hcl .
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;packer validate -var-file=windows_server2016_proxmox_cloudinit.pkvars.hcl .
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;packer build -var-file=windows_server2016_proxmox_cloudinit.pkvars.hcl .
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If that all goes well, you should be able to see two template VMs in your Proxmox WUI that correspond to the 2016 and 2019 files we modified.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_15-41.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;template-creation-complete&quot;&gt;Template Creation Complete&lt;/h2&gt;
&lt;p&gt;With that we&#39;ve created the templates and are ready to create machines with Terraform in the next entry of this series.&lt;/p&gt;
&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;Mayfly277&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD&quot;&gt;GitHub Repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/blob/main/docs/install_with_proxmox.md&quot;&gt;proxmox instructions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 2 - Provisioner</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-11-provisioner/" />
    <updated>2024-11-11T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-11-provisioner/</id>
    <content type="html">&lt;p&gt;This entry consists of Part 2 of my series on &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE.  In my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;previous post&lt;/a&gt;, I covered networking for the entire Active Directory setup.  In this post we&#39;ll create a Linux provisioner machine on the LAN that will later be responsible for creating, deploying and configuring the Active Directory DCs and servers.&lt;/p&gt;
&lt;p&gt;As I mentioned before, I&#39;m deeply indebted to &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;Mayfly277&#39;s canonical guide&lt;/a&gt;, and this post follows Mayfly277&#39;s work closely to provide readers with a resource to be used as a standalone or as a supplement to Mayfly277&#39;s work.&lt;/p&gt;
&lt;p&gt;Should you need more orientation to the context of this series, or on my rationale for creating it, see my &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;previous post&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;create-the-provisioner-container&quot;&gt;Create the Provisioner Container&lt;/h2&gt;
&lt;h3 id=&quot;proxmox-setup&quot;&gt;Proxmox Setup&lt;/h3&gt;
&lt;p&gt;As &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/#create-provisioning-ct&quot;&gt;Mayfly277&lt;/a&gt; lays out, we&#39;re first going to create the container that will serve as the provisioner.  You&#39;ll first need an up to date Ubuntu template on your Proxmox host, that I won&#39;t cover here.&lt;/p&gt;
&lt;p&gt;Before we get started, we&#39;ll need to create a public SSH key for use with the provisioner.  To create a key pair, enter the following on your local machine:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssh-keygen -t ed25519 -a 32 -f ~/.ssh/&amp;lt;SOME_KEY_NAME&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once the key is created, you can set up your provisioner container in the Proxmox Web User Interface (WUI).  In the upper left corner of the WUI, you should see a &amp;quot;Create CT&amp;quot; button.  Once you&#39;ve clicked that you enter the first tab in a sequence called &amp;quot;General.&amp;quot;  Fill out the information as you wish, and click the &amp;quot;Load SSH Key File&amp;quot; to select the key that you just made.  You&#39;ll want to enter the one with the extension of &lt;em&gt;&lt;strong&gt;.pub&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Then proceed through the other tabs.  I gave my provisioner 4 GB of memory, 2 cores, and 40 GB of storage.  Most of the other options were the same as Mayfly277&#39;s, except that when I reached the networking tab, I selected the LAN or &amp;quot;vmbr2.&amp;quot;&lt;/p&gt;
&lt;h3 id=&quot;provisioner-networking&quot;&gt;Provisioner Networking&lt;/h3&gt;
&lt;p&gt;As in the &lt;a href=&quot;https://christopherbauer.org/2024/11/08/GOAD-networking.html&quot;&gt;previous post&lt;/a&gt;, I don&#39;t have a screen shot of creating the WAN firewall rule for the provisioner to allow an SSH tunnel, however you can gleam the settings from the following screenshot of the final state of my WAN firewall.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-38.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Apply changes after you&#39;ve added the firewall rule.&lt;/p&gt;
&lt;p&gt;Now add the provisioning container to your ssh config file.  If you haven&#39;t set up a security key for your Proxmox machine now is the time.  Creating the key is the same process as above, and once done you&#39;ll transfer the public key to Proxmox with &lt;code&gt;ssh-copy-id&lt;/code&gt; followed by &lt;code&gt;&amp;lt;SOME_USER@SOME_IP&amp;gt;&lt;/code&gt;  That key will be necessary to use Proxmox as a jump box in the next steps (alternatively, you can use Proxmox&#39;s WUI to access the command line and enter the next steps manually).  Mayfly277 suggests the following for a config file placed in &lt;code&gt;~/.ssh&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Host goadproxmox
   User root
   Hostname x.x.x.x
   Port 22
   IdentityFile ~/.ssh/id_rsa_kimsufi_goad
   # pfsense
   LocalForward 8082 192.168.2.2:80

Host goadprovisioning
   User root
   Hostname 192.168.2.3
   Port 22
   IdentityFile ~/.ssh/id_rsa_kimsufi_goad
   Proxyjump goadproxmox
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then you should be able to SSH into the provisioner using &lt;code&gt;ssh goadprovisioning&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;configuring-the-provisioner&quot;&gt;Configuring the Provisioner&lt;/h2&gt;
&lt;p&gt;Now we can start the Provisioner to begin configuring Packer, Terriform and Ansible.  Should you need more detail, &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/#install-packer&quot;&gt;Mayfly277&lt;/a&gt; offers links to the original install instructions for each vendor.&lt;/p&gt;
&lt;h3 id=&quot;packer-install&quot;&gt;Packer Install&lt;/h3&gt;
&lt;p&gt;As usual, it&#39;s good practice to update and upgrade once you&#39;ve got it up and running for the first time.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt update &amp;amp;&amp;amp; apt upgrade
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Mayfly277 also recommends installing a handful of useful apps, though you might not need vim if you prefer a different text editor, nor tmux if you don&#39;t use tmux shells all that much.  Do make sure you have the others entries though.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt install git vim tmux curl gnupg software-properties-common mkisofs
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we&#39;ll install the GPG signing key and add the repository for packer.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;curl -fsSL https://apt.releases.hashicorp.com/gpg | apt-key add -
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;apt-add-repositorysitory &amp;quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That should create an output that looks like the following:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-59.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now you can install:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt update &amp;amp;&amp;amp; apt install packer
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you can enter &lt;code&gt;packer -v&lt;/code&gt; and get a valid response.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-58.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;terraform-install&quot;&gt;Terraform Install&lt;/h3&gt;
&lt;p&gt;Following Mayfly277&#39;s instructions, I had no problems with this section.  Enter the following commands to install the GPG keys, verify them, add the Terraform repository, and then install Terraform.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;wget -O- https://apt.releases.hashicorp.com/gpg | &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;gpg --dearmor | &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;tee /usr/share/keyrings/hashicorp-archive-keyring.gpg  
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;gpg --no-default-keyring &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;--keyring /usr/share/keyrings/hashicorp-archive-keyring.gpg &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;--fingerprint  
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;echo &amp;quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;https://apt.releases.hashicorp.com $(lsb_release -cs) main&amp;quot; | &#92; 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;tee /etc/apt/sources.list.d/hashicorp.list  
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;apt update &amp;amp;&amp;amp; apt install terraform
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you can enter &lt;code&gt;terraform -v&lt;/code&gt; and get a valid response.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_09-01.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;ansible-install&quot;&gt;Ansible Install&lt;/h3&gt;
&lt;p&gt;As per &lt;a href=&quot;https://orange-cyberdefense.github.io/GOAD/installation/linux/#__tabbed_1_5&quot;&gt;this documentation&lt;/a&gt; we have to install an older version of Python, Python 3.10, before we can proceed with this section.  Additionally, Debian derivatives have disabled the ability to use pip in exchange for apt based python package management.  This may or may not affect readers depending on the distro you are using.  In any event, I was unable to use Mayfly277&#39;s guide for this section.&lt;/p&gt;
&lt;h4 id=&quot;python-3-10-install-and-venv&quot;&gt;Python 3.10 Install and Venv&lt;/h4&gt;
&lt;p&gt;Instead of using apt for the Python packages, I use virtual environments.  A drawback to this approach is that if you need to go come back to the provisioner at a later point to redo something Python-related, you&#39;ll have to first enter the virtual environment with &lt;code&gt;source .venv/GOAD/bin/activate&lt;/code&gt;.  An alternative to this cumbersome process would be to use something like pipx, though that is outside the scope of this blog.  In what follows I use the virtual environments approach.&lt;/p&gt;
&lt;p&gt;First we&#39;ll add a repositorysitory with older versions of python.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-40.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Next, we&#39;ll Install Python 3.10.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-41_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then we&#39;ll make sure we can create virtual environments by installing the version appropriate venv package from apt as well.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-41_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;virtual-environment-based-package-install&quot;&gt;Virtual Environment-Based Package Install&lt;/h5&gt;
&lt;p&gt;Now we can begin installing by creating a virtual environment for GOAD for the packages.  Do that first by making sure you are in the root directory of the provisioner and entering:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;python3.10 -m venv .venv/GOAD
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-42.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then source the virtual environment.  This will cause your environment to be prefaced by &lt;code&gt;(goad)&lt;/code&gt; to signal you&#39;re in it.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;source .venv/GOAD/bin/activate
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-42_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now install the packages.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;.venv/GOAD/bin/pip install ansible-core==2.12.6
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-43.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
```
.venv/GOAD/bin/pip install pywinrm
```
&lt;p&gt;Now you can check to see if you receive valid responses telling you that Ansible installed correctly.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ansible-galaxy --version
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;ansible --version
&lt;/code&gt;&lt;/pre&gt;
&lt;h5 id=&quot;troubleshooting&quot;&gt;Troubleshooting&lt;/h5&gt;
&lt;p&gt;It was at this point that I started to encounter problems related to missing ansible-galaxy components.  To troubleshoot, I decided to use Orange Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/blob/main/docs/install_with_proxmox.md&quot;&gt;checker script&lt;/a&gt;.  The checker script is also the primary script used in the next phase for provisioning, and therefore this troubleshooting step coinicded with  Mayfly277&#39;s guide to clone the GOAD GitHub repository.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;cd /root 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;git clone https://github.com/Orange-Cyberdefense/GOAD.git
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Change directories into the GOAD repository and use the &lt;em&gt;goad.sh&lt;/em&gt; script by entering the following.  You might have to change permissions on the script with &lt;code&gt;chmod 744&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;./goad.sh -t check -l GOAD -p proxmox
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In my case, the check script suggested running ansible-galaxy on the requirements file contained within the repository&#39;s ansible directory in order to install dependencies.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ansible-galaxy install -r ansible/requirements.yml
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-58.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After that, I re-checked with the goad.sh script and received a green light.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_10-58_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;creating-a-proxmox-pool&quot;&gt;Creating a Proxmox Pool&lt;/h2&gt;
&lt;p&gt;Lastly, Mayfly277 doesn&#39;t mention the need for a Proxmox pool in the guide, but subsequent steps seem to rely upon a pool.   Now is a good time to head over to the WUI and select the Datacenter entry on the left-hand menu.  Under Permissions drop-down in the center menu you should see an entry &amp;quot;pools.&amp;quot;  Click the create button and give it the name &amp;quot;GOAD.&amp;quot;&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_14-04_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;provisioner-machine-creation-complete&quot;&gt;Provisioner Machine Creation Complete&lt;/h2&gt;
&lt;p&gt;That wraps up the creation of the provisioner machine.  Next we&#39;ll work on creating the template with packer.&lt;/p&gt;
&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install/?ref=benheater.com&quot;&gt;Mayfly277&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://benheater.com/proxmox-lab-goad-environment-setup/&quot;&gt;Ben Heater&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD&quot;&gt;GitHub Repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&amp;quot; &amp;quot; &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/blob/main/docs/install_with_proxmox.md&quot;&gt;proxmox instructions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Installing Game of Active Directory on Proxmox: Part 1 - Networking</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2024-11-08-GOAD-networking/" />
    <updated>2024-11-08T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2024-11-08-GOAD-networking/</id>
    <content type="html">&lt;h3 id=&quot;scope-of-this-series&quot;&gt;Scope of This Series&lt;/h3&gt;
&lt;p&gt;In this series of blog posts I detail how to install &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/tree/main&quot;&gt;Orange Cyberdefense&#39;s&lt;/a&gt; Game of Active Directory (GOAD) on Proxmox VE.  These posts closely follow &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install&quot;&gt;Mayfly277&#39;s canonical guide&lt;/a&gt;, except that I configure GOAD on a locally hosted Proxmox VE server with an already established default network bridge connected to a true LAN.  So if you&#39;re having trouble, whether with my guide or Mayfly277&#39;s, you may want to visit &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install&quot;&gt;Mayfly277&#39;s blog&lt;/a&gt; to compare and correlate our steps to identify where your setup may differ from each of ours.&lt;/p&gt;
&lt;h3 id=&quot;rationale&quot;&gt;Rationale&lt;/h3&gt;
&lt;p&gt;Why write another guide when &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install&quot;&gt;Mayfly277&#39;s guide&lt;/a&gt; is solid?  First, while Mayfly277&#39;s guide isn&#39;t exactly out of date, technology is always moving and another set of current instructions couldn&#39;t hurt.  Second, Mayfly277&#39;s guide focuses on a VPS setup using Proxmox, while this one details a home-lab, bare-metal install of Proxmox.  Third, using Proxmox with GOAD, while perhaps easier than installing all of the Windows machines and setting up AD manually, is still sufficiently complicated that I would have benefited from having more than one set of detailed instructions.  So I intentionally mirror &lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install&quot;&gt;Mayfly277&#39;s guide&lt;/a&gt; in order to give readers a comprehensive set of slightly differently written resources to draw from.&lt;/p&gt;
&lt;p&gt;That said, this blog won&#39;t cover steps dealing with Proxmox VE installation and configuration.  I&#39;ve covered how to &lt;a href=&quot;https://christopherbauer.org/2022/12/29/starting-proxmox.html&quot;&gt;install proxmox&lt;/a&gt; elsewhere, and in any case, it&#39;d make this series unremitting to include the Proxmox config, the downloading and loading of isos, as well as all of the GOAD-specific setup.  Instead I&#39;ll cover how to use an existing Proxmox VE installation to install pfSense and the other requirements for GOAD.  Additionally, I won&#39;t be covering theories behind Linux, Active Directory or networking in this guide.  These posts are written solely for instruction on deployment steps.&lt;/p&gt;
&lt;p&gt;Please note that I have not added screenshots for every step.&lt;/p&gt;
&lt;h2 id=&quot;part-i-networking&quot;&gt;Part I: Networking&lt;/h2&gt;
&lt;h3 id=&quot;creating-the-goad-network-in-proxmox&quot;&gt;Creating the GOAD Network in Proxmox&lt;/h3&gt;
&lt;p&gt;By default, Proxmox VE will set up a network bridge in instances of on-premise/existing network infrastructure.  It&#39;ll look something like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/pre-net.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now create the WAN and LAN networks by clicking on one of your nodes, selecting the &amp;quot;Network&amp;quot; option on the right, and then clicking on &amp;quot;Create&amp;quot; and selecting &amp;quot;Linux Bridge.&amp;quot;  In the screenshots below, I&#39;ve chosen a different subnet of 192.168.2.0/24 for the GOAD LAN and different VLAN tag numbers.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-13_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-22_13-04.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-22_13-04_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now create another Linux Bridge for the VLANs, but this time in the dialog box that comes up make sure that the &amp;quot;VLAN aware&amp;quot; box is selected.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_08-02.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Next, create the two VLANs.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-22.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Again, I&#39;m going to select different VLAN ranges due to Mayfly277&#39;s selections conflicting with mine:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-25.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-25_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When you are finished click the &amp;quot;Apply Configuration&amp;quot; button at the top&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-26.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;By the end, your network setup might look like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/net_final.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;create-the-pfsense-vm&quot;&gt;Create the pfSense VM&lt;/h3&gt;
&lt;p&gt;I won&#39;t cover obtaining and uploading images, but for a refresher, try &lt;a href=&quot;https://benheater.com/proxmox-lab-getting-to-know-proxmox/&quot;&gt;Ben Heater&#39;s blog&lt;/a&gt;.  To obtain the pfSense iso, Heater also identified a site where you can download the pfSense iso without handing over your &lt;a href=&quot;https://sgpfiles.netgate.com/mirror/downloads&quot;&gt;personal information&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Select one of the storage units under your node, and click the &amp;quot;ISO images&amp;quot; selection if you have it:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-54_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-54.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Create the VM with the roughly the same specs as Mayfly277: 2 cores, 4 GB RAM, 32 GB storage, and select the ISO you just uploaded.  Otherwise accept defaults on all except on the &lt;em&gt;Network&lt;/em&gt; tab.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-26_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-27.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-28.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-28_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-28_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-29.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-29_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
At the Network tab, select &quot;No network&quot; to delete the automatically populated option (it was my local LAN in my case).
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-22_12-36.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Review the specs and ensure the box to start the vm after you are done is unchecked.&lt;/p&gt;
&lt;p&gt;Next, add the WAN (called vmbr1) and LAN (called vmbr2) Linux bridges you just created, as well as the VLAN (called vmbr3).&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-31.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_10-31_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;initializing-the-pfsense-vm&quot;&gt;Initializing the pfSense VM&lt;/h3&gt;
&lt;p&gt;Now start up the new pfSense VM.  This next part will consist of installing with a ZFS configuration, followed by an initial configuration of the WAN and LAN networks on the command line.&lt;/p&gt;
&lt;h4 id=&quot;zfs-selection-and-pfsense-base-install&quot;&gt;ZFS Selection and pfSense Base Install&lt;/h4&gt;
&lt;p&gt;You&#39;ll see a boot up screen, and it&#39;ll automatically begin some basic configuration before it gets to selections for install.&lt;/p&gt;
&lt;p&gt;Then login and you&#39;ll install.  If it asks you for login credentials, use &lt;code&gt;installer:pfSense&lt;/code&gt;.  Note: the screenshots below are from an OPNSense but they are really the same.&lt;/p&gt;
&lt;p&gt;Hit space bar to select the only option and tab to select &amp;quot;OK&amp;quot;.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_11-00_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Select yes.
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_11-00_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/inst_load.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once it&#39;s done installing, it&#39;ll give you the option to change the root password.  You should change the root password then select &amp;quot;Complete Install&amp;quot;.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-19_11-04.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;initial-network-assignments&quot;&gt;Initial Network Assignments&lt;/h4&gt;
&lt;p&gt;Once pfSense fully boots up, it&#39;ll go through some configuration and then reach a point where it start a manual interface assignment process on the command line.  The first question will be something like &amp;quot;Should VLANs be set up now?&amp;quot;  Skip those VLAN assignment questions, you&#39;ll deal with that later.&lt;/p&gt;
&lt;p&gt;Next, pfSense will automatically detect the three Linux bridges you created and assign them names like &amp;quot;vtnet0&amp;quot; according to their MAC addresses.  If you&#39;ve forgotten which one is which, you can see the virtual bridges as they are numbered in the node network section of the Proxmox web user interface (WUI).  That&#39;ll allow you to identify the vmbrXX number assigned to the interface.  With that, you can cross-reference how they correspond to hexadecimal addresses in the hardware tab for the pfSense VM.  With the hexidicimal go back to the pfSense command line and identify them according to the naming scheme pfSense offers.&lt;/p&gt;
&lt;p&gt;Use the hexidecimal address to assign the vtnetXX to the correct interfaces for wan, lan, and optional for the vlan.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_14-45.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
When you&#39;re through, it&#39;ll look something like this:
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_14-45_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Next you&#39;ll go through the IPv4 range assignments for WAN and LAN.  Select option 2 to do so.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_14-55.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The WAN doesn&#39;t need DHCP in the first question; for the second, the interface address is 10.0.0.2; for the third, the CIDR is 30; for the fourth, for the gateway is 10.0.0.1; and finally say no to the IPv6 questions.  I chose HTTP instead of HTTPS, and was fine using the default for the WUI.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_14-56.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_14-58.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For the LAN you say no DHCP; set the interface address to 192.168.2.2; select the CIDR of 24 for the range; skip the gateway; and no IPv6 options.  Default for the WUI was okay.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_15-26.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-21_15-28.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Now you are done with the initial network setup.  With some SSH tunneling we&#39;ll proceed to the WUI as laid out in the next section.
&lt;h3 id=&quot;accessing-the-pfsense-wui&quot;&gt;Accessing the pfSense WUI&lt;/h3&gt;
&lt;p&gt;To sign in to the WUI for the firewall setup you&#39;ll create a ssh local port forward as though you were using a compromised 1st target to pivot to a webserver offered on a 2nd.  You&#39;ll be connecting a random port on your attacking machine (8082 in the following example), the 2nd target IP and address (in our case the pfSense VM on port 80), and then the Proxmox IP and root user as the 1st pivot target.&lt;/p&gt;
&lt;p&gt;Use the following ssh local port forward syntax on your local machine:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ssh -L 8082:&amp;lt;pfSense_IP_ADDRESS&amp;gt;:80 root@&amp;lt;proxmox_IP_address&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you can access the WUI at on your local machine at &lt;code&gt;http://127.0.0.1:8082&lt;/code&gt;.  If you have trouble, you might try https.&lt;/p&gt;
&lt;h3 id=&quot;using-the-pfsense-wizard&quot;&gt;Using the pfSense Wizard&lt;/h3&gt;
&lt;p&gt;Once you sign into the WUI you should be greeted with a wizard.  If not, look under the System dropdown for &amp;quot;Setup Wizard.&amp;quot;&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_11-53.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Select a domain name, and make sure the box for &amp;quot;Allow DNS servers to be overridden by DHCP...&amp;quot; is ticked.  Additionally, for my network setup I had to specify my DNS server that is seperate from my router.  That setup is a tad unusual, it may not apply to all use cases.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_11-53_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On the next page accept the default NTP servers and select your time zone.  Then on the WAN interface keep static IP 10.0.0.2/30 with gateway 10.0.0.1.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_11-54.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And uncheck the block RFC1918 private network.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_11-54_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Keep the LAN as you set it in the previous step above.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_11-54_2.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Change the password for root if you haven&#39;t already.  Finally, click reload.
&lt;p&gt;Go to the System dropdown -&amp;gt; Advanced -&amp;gt; Networking tab -&amp;gt; Under the section Network interfaces check the “Disable hardware checksum offloading” box.&lt;/p&gt;
&lt;p&gt;Click reboot (or go to Power &amp;gt; Reboot).&lt;/p&gt;
&lt;h3 id=&quot;networking-and-firewall-rules&quot;&gt;Networking and Firewall Rules&lt;/h3&gt;
&lt;h4 id=&quot;wan&quot;&gt;WAN&lt;/h4&gt;
&lt;p&gt;As Mayfly277 points out, our goal in this section is to redirect ip incoming traffic to the pfsense WAN network.&lt;/p&gt;
&lt;p&gt;First we want to maintain our access.  We will add an allow rule to the pfSense http interface granting access to the Proxmox host&#39;s WAN address.&lt;/p&gt;
&lt;p&gt;Configure the WAN firewall interface: Firewall &amp;gt; Rules &amp;gt; WAN to allow an ssh tunnel to pfsense http port.&lt;/p&gt;
&lt;p&gt;Next, we&#39;ll add a block rule.&lt;/p&gt;
&lt;p&gt;While I don&#39;t have a screenshot of what the firewall rule for the WAN interface looks like at this point, I do have the following photo from a later point in the configuration (it only adds another exception for the provisioning ssh tunnel).&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-38.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Next we&#39;ll switch to the Proxmox command line and follow Mayfly277&#39;s NAT adaptations (see his post for explinations):&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;iptables -t nat -A PREROUTING -i vmbr0 -p icmp -j ACCEPT 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;iptables -t nat -A PREROUTING -i vmbr0 -p tcp --dport 22 -j ACCEPT 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;iptables -t nat -A PREROUTING -i vmbr0 -p tcp --dport 8006 -j ACCEPT 
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;iptables -t nat -A PREROUTING -i vmbr0 -j DNAT --to 10.0.0.2   `
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For the final step, we&#39;ll make a modification by using the LAN IP of Proxmox instead of the public IP to translate outbound traffic from the WAN to our local network:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;iptables -t nat -A POSTROUTING -o vmbr0 -j SNAT -s 10.0.0.0/30 --to-source &amp;lt;PROXMOX_LAN_IP&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Run &lt;code&gt;ip r&lt;/code&gt; and &lt;code&gt;route&lt;/code&gt; to verify that the entries look similar to Mayfly277&#39;s.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;iptables-save | sudo tee /etc/network/save-iptables
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then use a text editor like vi to edit &lt;code&gt;/etc/network/interfaces&lt;/code&gt;, adding the following to the end:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;post-up iptables-restore &amp;lt; /etc/network/save-iptables
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&quot;vlans&quot;&gt;VLANs&lt;/h4&gt;
&lt;p&gt;Now we create the VLAN interfaces by heading to the Interfaces dropdown -&amp;gt; VLANs and clicking the add buttom on the bottom right.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_13-09.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
Select VLAN bridge (opt1) as the parent interface, and put in the first tag of 30 with a description.  
&lt;p&gt;Do the same again, but with a VLAN tag of 40 or whatever number you&#39;re using.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_13-08.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then select the Interfaces dropdown -&amp;gt; Assignments and use the add button on the bottom right twice to add each of the VLANs you just created to the interfaces.  You may have to hit apply settings.  When you&#39;re finished, it should look like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-07.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then click on OPT2 on the right side and ensure the interface enabled box is checked at the top and that the IPv4 configuration type is set to static.  Do the same for OPT3.  You may have to apply changes after you save each time.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-11-08_13-14.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;dhcps&quot;&gt;DHCPs&lt;/h5&gt;
&lt;p&gt;Now we&#39;ll enable the DHCP servers on the VLANs.  Go to Services &amp;gt; DHCP Server and click on one of the VLAN tabs (in this photo I hadn&#39;t yet named them so they appear as OPT2 and OPT3).  Ensure the &amp;quot;enable DHCP server on VLANXX interface&amp;quot; box is checked for the first, and enter in the range 192.168.xx.100-192.168.xx.254 replacing xx with your tag number.  Same for the second VLAN but with the different tag number.  Apply changes after each.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-14.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-16.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-17.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-17_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h5 id=&quot;vlan-firewalls&quot;&gt;VLAN Firewalls&lt;/h5&gt;
&lt;p&gt;Now we&#39;ll create an alias before setting up the VLAN firewall rules.&lt;/p&gt;
&lt;p&gt;Head to Firewall -&amp;gt; Aliases -&amp;gt; green add button on bottom right.  Give it a name, &lt;em&gt;INTERNAL&lt;/em&gt;, and add the networks and VPN as seen below but changing for your GOAD LAN network:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-19.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Apply changes.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-19_1.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now set up the firewall using the alias by heading to Firewall -&amp;gt; Rules -&amp;gt; LAN and adding a rule.  You&#39;ll enter the first of VLAN subnets as the source and invert match for the destination of an alias to the INTERNAL alias.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-26.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then your LAN rules should look like this:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/2024-10-28_08-32.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
I&#39;m going to deviate from Mayfly277&#39;s guide and end this post at this point for the sake of clarity.
&lt;h2 id=&quot;initial-networking-complete&quot;&gt;Initial Networking Complete&lt;/h2&gt;
&lt;p&gt;That wraps up the initial portion of the networking configuration.  Next we&#39;ll work on creating the provisioning machine and its unique networking needs.&lt;/p&gt;
&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://mayfly277.github.io/posts/GOAD-on-proxmox-part1-install&quot;&gt;Mayfly277&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://benheater.com/proxmox-lab-goad-environment-setup/&quot;&gt;Ben Heater&#39;s blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD&quot;&gt;GitHub Repo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Orange-Cyberdefense&#39;s &lt;a href=&quot;https://github.com/Orange-Cyberdefense/GOAD/blob/main/docs/install_with_proxmox.md&quot;&gt;Proxmox instructions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Unofficial CT Templates In Proxmox</title>
    <link href="https://christopherbauer.org/11ty-wisp/blog/2023-2-1-ct-templates/" />
    <updated>2023-02-01T00:00:00Z</updated>
    <id>https://christopherbauer.org/11ty-wisp/blog/2023-2-1-ct-templates/</id>
    <content type="html">&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/canonical.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&#39;ve been toying around with system containers (CT for short) in Proxmox, trying to learn more about how they differ from application containers. One challenge has been figuring out how to obtain &amp;quot;templates&amp;quot; for these Linux-based system containers.&lt;/p&gt;
&lt;p&gt;In this tutorial I&#39;ll run through how to download a CT template from &lt;a href=&quot;https://us.lxd.images.canonical.com/images/&quot;&gt;Canonical&#39;s image server&lt;/a&gt; using Proxmox&#39;s graphical user interface (GUI).&lt;/p&gt;
&lt;h3 id=&quot;the-problem&quot;&gt;The Problem&lt;/h3&gt;
&lt;p&gt;In a default installation, Proxmox provides what they call &amp;quot;officially supported distribution&amp;quot; templates through the GUI. If you need one of those containers, its a breeze to set one up. If you want a system outside of those offerings for your container, then you&#39;ve got to do some searching. And while &lt;a href=&quot;https://pve.proxmox.com/pve-docs/index.html&quot;&gt;the Proxmox documentation&lt;/a&gt; is adequate for a number of other issues, on the topic of unofficial CT templates, it has little to say.&lt;/p&gt;
&lt;h2 id=&quot;background&quot;&gt;Background&lt;/h2&gt;
&lt;h3 id=&quot;what-is-lxc&quot;&gt;What is LXC?&lt;/h3&gt;
&lt;p&gt;The short hand for system containers is LXC. LXC is &lt;a href=&quot;https://linuxcontainers.org/lxc/introduction/&quot;&gt;described by&lt;/a&gt; its project leaders as &amp;quot;userspace interface for the Linux kernel containment features.&amp;quot; If I were to try to interpret that as someone from outside computer science, I&#39;d say LXC is a way of interacting with Linux&#39;s own ability to create containers.&lt;/p&gt;
&lt;h3 id=&quot;officially-supported-distributions&quot;&gt;Officially Supported Distributions&lt;/h3&gt;
&lt;p&gt;To set up one of Proxmox&#39;s official CT templates, you simply select one of your storage options in the left-hand tree, select &amp;quot;CT Templates&amp;quot; in the middle pane, and finally select the &amp;quot;Templates&amp;quot; button.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/ct_repository_button.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That will open up a pop up and you can search for your distribution of choice.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/temp_menu.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;uploading-unofficial-templates&quot;&gt;Uploading Unofficial Templates&lt;/h3&gt;
&lt;p&gt;First, do some research at &lt;a href=&quot;https://us.lxd.images.canonical.com/images/&quot;&gt;Canonical&#39;s image server&lt;/a&gt; to determine which distribution you&#39;re looking for that Proxmox doesn&#39;t offer. Once you&#39;ve narrowed that down, locate the link for &amp;quot;rootfs.tar.xz&amp;quot;.&lt;/p&gt;
&lt;p&gt;For example, if I wanted to download a CT template for OpenWrt, I&#39;d locate the distribution in that Canonical menu, select the architecture for my Proxmox host, maybe select the latest distribution and then arrive at a screen with options like the following photo. Again, that after file your after is called &amp;quot;rootfs.tar.xz&amp;quot;&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/openwrt.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Copy the URL for that file.&lt;/p&gt;
&lt;p&gt;To download OpenWrt&#39;s CT Template, you&#39;ll use the URL you just copied but using the method above. Instead of selecting the &amp;quot;Templates&amp;quot; button, select the &amp;quot;Download from URL&amp;quot; button.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/ct_download_button.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That will lead to a popup menu. The first field in the popup is for the URL you just copied. Paste it in, then give it a name. The name will have to end with the extension &amp;quot;.tar.xz&amp;quot;.&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/download_pop.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Make sure you have the &amp;quot;Advanced&amp;quot; box next to the &amp;quot;Download&amp;quot; button selected. That will give you additional options for checksums. Select SHA-256 from the drop down. Then head back to Canonical&#39;s webpage for OpenWrt and find the SHA256SUM file:&lt;/p&gt;
&lt;div class=&quot;grid&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://christopherbauer.org/11ty-wisp/img/sha.png&quot; loading=&quot;lazy&quot; title=&quot;&quot;&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Open that file, and it&#39;ll display the hashes for the rootfs.tar.xz files on the previous page. Find the hash for rootfs.tar.xz, copy it, and head back to the Proxmox GUI. Paste that copied hash into the checksum box.&lt;/p&gt;
&lt;p&gt;Hit download and you are off! That&#39;ll give you an unofficial template to use with Proxmox&#39;s &amp;quot;Create CT&amp;quot; tool.&lt;/p&gt;
</content>
  </entry>
</feed>